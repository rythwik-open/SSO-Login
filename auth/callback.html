<!DOCTYPE html>
<html>
<head>
  <title>SSO Callback</title>
</head>
<body>
  <h1>Logging you in...</h1>
  <script>
    async function handleCredentialResponse() {
      const urlParams = new URLSearchParams(window.location.search);
      const credential = urlParams.get("credential");

      if (!credential) {
        alert("No credential found in URL.");
        return;
      }

      // Decode JWT payload
      const payload = JSON.parse(atob(credential.split('.')[1]));
      const userId = payload.sub;
      const email = payload.email;
      const fetchedName = payload.name;

      // Ask user to confirm/edit name
      const finalName = prompt("Please confirm your name:", fetchedName) || fetchedName;

      // Send data to backend
      const res = await fetch("https://YOUR_API_GATEWAY_URL/create-user", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          userId,
          email,
          fetchedName,
          finalName
        })
      });

      if (res.ok) {
        // Success - redirect to dashboard
        window.location.href = "/dashboard.html";
      } else {
        alert("Error saving user to DB.");
      }
    }

    handleCredentialResponse();
  </script>
</body>
</html>
