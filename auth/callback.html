<!DOCTYPE html>
<html>
<head>
  <title>Google SSO Callback</title>
  <script>
    // Function to decode JWT
    function decodeJWT(token) {
      const payload = token.split('.')[1];
      return JSON.parse(atob(payload));
    }

    window.onload = async function () {
      const params = new URLSearchParams(window.location.search);
      const credential = params.get("credential");

      if (!credential) {
        document.body.innerHTML = "<h2>No token found.</h2>";
        return;
      }

      const decoded = decodeJWT(credential);
      const userId = decoded.sub;
      const email = decoded.email;
      const fetchedName = decoded.name;

      // ðŸ‘‡ Prompt the user to confirm or edit the name
      const finalName = prompt("Please confirm or edit your full name:", fetchedName);

      if (!finalName) {
        alert("You must enter a name to continue.");
        return;
      }

      // ðŸ‘‡ Log or send to API (right now just console log for testing)
      const userData = {
        userId,
        email,
        fetchedName,
        finalName
      };

      console.log("User data to save:", userData);

      // Replace with actual fetch when ready
      // const res = await fetch("https://YOUR_API_URL/create-user", {
      //   method: "POST",
      //   headers: { "Content-Type": "application/json" },
      //   body: JSON.stringify(userData)
      // });

      // if (res.ok) {
      //   window.location.href = "/dashboard.html";
      // } else {
      //   alert("Error saving user to DB");
      // }
    };
  </script>
</head>
<body>
  <h2>Signing you in...</h2>
</body>
</html>
